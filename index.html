<!doctype html>
<html lang="id">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Warung Pak Jhon Regency - Demo</title>
<style>
  :root{
    --bg:#ffffff; --card:#fff; --muted:#6b7280; --accent:#f6b21a; --primary:#0f4f4b;
    --shadow: 0 6px 20px rgba(15,31,41,.06);
  }
  *{box-sizing:border-box}
  body{font-family:Inter,system-ui,Segoe UI,Roboto,"Helvetica Neue",Arial;background:var(--bg);margin:0;color:#111}
  header{background:linear-gradient(90deg,#0b4b47,#0f6a63);color:#fff;padding:18px 24px;display:flex;align-items:center;gap:14px}
  header img{width:56px;height:56px;border-radius:8px;object-fit:cover;border:3px solid rgba(255,255,255,.06)}
  header .brand{font-size:18px;font-weight:700}
  .wrap{max-width:1100px;margin:24px auto;padding:0 18px;display:grid;grid-template-columns:1fr 340px;gap:20px}
  .panel{background:var(--card);border-radius:12px;padding:18px;box-shadow:var(--shadow)}
  .hero{grid-column:1 / span 2;margin-bottom:8px}
  h2{margin:0 0 12px 0}
  .categories{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:12px}
  .chip{padding:8px 12px;border-radius:999px;border:1px solid #e6e6e6;background:#fff;cursor:pointer}
  .chip.active{background:#0f6a63;color:#fff;border-color:transparent}
  .search{display:flex;gap:8px;margin-bottom:12px}
  .search input{flex:1;padding:10px;border-radius:8px;border:1px solid #e6e6e6}
  .menu-grid{display:grid;grid-template-columns:1fr 1fr;gap:14px}
  .card{display:flex;gap:12px;align-items:center;padding:12px;border-radius:10px;border:1px solid #f1f1f1;background:#fff}
  .card img{width:110px;height:78px;object-fit:cover;border-radius:8px;flex-shrink:0}
  .card .info{flex:1}
  .price{font-weight:700;color:#111;margin-top:6px}
  .btn{padding:8px 12px;border-radius:8px;border:none;cursor:pointer}
  .btn-add{background:var(--accent);color:#111;font-weight:700}
  .btn-view{background:#fff;border:1px solid #ddd}
  /* sidebar */
  .cart-empty{color:var(--muted)}
  .cart-item{display:flex;justify-content:space-between;align-items:center;padding:8px 0;border-bottom:1px dashed #eee}
  select,input{width:100%;padding:10px;border-radius:8px;border:1px solid #e6e6e6;margin-bottom:8px}
  .checkout-btn{background:#0f6a63;color:#fff;padding:10px;border-radius:8px;border:none;width:100%;font-weight:700}
  /* pages */
  .page{display:none}
  .page.active{display:block}
  .center{text-align:center}
  footer{max-width:1100px;margin:20px auto;text-align:center;color:var(--muted);font-size:13px}
  /* simple responsive */
  @media(max-width:980px){.wrap{grid-template-columns:1fr;}.menu-grid{grid-template-columns:1fr}}
</style>
</head>
<body>

<header>
  <!-- leave src empty, we'll set it in JS to ensure correct IMAGES_PREFIX usage -->
  <img id="logo" src="" alt="logo">
  <div>
    <div class="brand">Warung Pak Jhon Regency</div>
    <div style="font-size:12px;opacity:.9">Ruko De Blossom Ville, Blok E3 No.11, Sepinggan</div>
  </div>
  <div style="margin-left:auto;color:#fff;font-weight:600" id="mejaInfo">Meja: 12 kosong • 0 terpakai</div>
  <button id="logoutBtn" style="margin-left:12px;padding:8px 12px;border-radius:8px;border:none;background:var(--accent);font-weight:700;cursor:pointer;color:#111">Keluar</button>
</header>

<!-- MAIN WRAP -->
<div class="wrap">

  <!-- left column (pages) -->
  <div>

    <!-- LOGIN PAGE -->
    <div id="pageLogin" class="page active panel">
      <h2 class="center">Selamat datang di Warung Pak Jhon Regency</h2>
      <div style="display:flex;gap:14px;flex-wrap:wrap">
        <div style="flex:1;min-width:260px">
          <h3>Buat Akun</h3>
          <input id="reg_name" placeholder="Nama lengkap">
          <input id="reg_phone" placeholder="Nomor HP">
          <input id="reg_email" placeholder="Email">
          <input id="reg_pass" placeholder="Password" type="password">
          <button class="btn btn-add" onclick="register()">Daftar</button>
        </div>
        <div style="flex:1;min-width:260px">
          <h3>Masuk</h3>
          <input id="login_id" placeholder="Email atau No HP">
          <input id="login_pw" placeholder="Password" type="password">
          <button class="btn btn-add" onclick="login()">Masuk</button>
          <div style="margin-top:10px;color:var(--muted)">Demo: klik <b>Demo User</b> untuk cepat coba fitur.</div>
          <button style="margin-top:8px" class="btn btn-view" onclick="demoLogin()">Demo User</button>
        </div>
      </div>
    </div>

    <!-- DASHBOARD / MENU PAGE -->
    <div id="pageMenu" class="page panel">
      <div class="hero panel">
        <h2 id="greeting">Halo, Pengunjung</h2>
        <div style="color:var(--muted)">Silakan pilih kategori, tambah ke keranjang, lalu atur pengiriman & checkout.</div>
      </div>

      <div class="panel">
        <div style="display:flex;justify-content:space-between;align-items:center;">
          <h3 style="margin:0">Daftar Menu</h3>
          <div style="color:var(--muted)">Pilih kategori atau cari</div>
        </div>

        <div style="margin-top:12px" class="categories" id="cats"></div>
        <div class="search">
          <input id="search" placeholder="Cari menu..." oninput="renderMenu()">
          <select id="sort" onchange="renderMenu()">
            <option value="default">Urut</option>
            <option value="price_asc">Minuman↓</option>
            <option value="price_desc">Makanan↑</option>
          </select>
        </div>

        <div class="menu-grid" id="menuGrid"></div>
      </div>

    </div>

    <!-- CHECKOUT / NOTA PAGE -->
    <div id="pageNota" class="page panel">
      <h2>Ringkasan & Nota</h2>
      <div id="notaContent"></div>
      <div style="margin-top:12px;display:flex;gap:8px">
        <button class="btn btn-add" onclick="printNota()">Cetak / Print Nota</button>
        <button class="btn btn-view" onclick="go('pageMenu')">Kembali</button>
      </div>
    </div>

  </div>

  <!-- right column (sidebar) -->
  <aside>
    <div class="panel">
      <h3>Keranjang <span id="cartCount" style="color:var(--muted)">(0)</span></h3>
      <div id="cartList"><div class="cart-empty">Belum ada item</div></div>

      <div style="margin-top:12px">
        <div style="color:var(--muted)">Lokasi Pengiriman</div>
        <select id="region">
          <option value="regency">Dalam Regency</option>
          <option value="outside">Luar Regency</option>
        </select>
        <div style="color:var(--muted);margin-top:8px">Pengiriman</div>
        <select id="deliveryType" onchange="updateOngkir()">
          <option value="dinein">Makan di Tempat</option>
          <option value="delivery">Diantar</option>
        </select>
        <input id="distance" type="number" min="0" placeholder="Jarak (km jika diantar)" value="1" oninput="updateOngkir()">
        <div style="margin-top:8px">No. Meja</div>
        <select id="tableNo"><option value="">Pilih meja (opsional)</option></select>
        <div style="margin-top:8px">Metode Pembayaran</div>
        <select id="payMethod"><option value="cash">Tunai</option><option value="qris">QRIS</option></select>

        <div style="margin-top:12px;padding:10px;border-radius:8px;background:#fff;border:1px solid #f1f1f1">
          <div>Subtotal: Rp <span id="subtotal">0</span></div>
          <div>Ongkir: Rp <span id="ongkir">0</span></div>
          <div style="font-weight:800;margin-top:6px">Total: Rp <span id="grand">0</span></div>
        </div>

        <button style="margin-top:12px" class="checkout-btn" onclick="openCheckout()">Checkout</button>
        <button style="margin-top:8px" class="btn btn-view" onclick="clearCart()">Kosongkan</button>
      </div>
    </div>

    <!-- meja panel -->
    <div class="panel" style="margin-top:14px">
      <h4>Panel Meja</h4>
      <div id="tablePanel" style="display:flex;flex-wrap:wrap;gap:8px;margin-top:10px"></div>
      <div style="font-size:12px;color:var(--muted);margin-top:8px">Klik nomor meja untuk ubah status (kosong/terpakai).</div>
    </div>

  </aside>
</div>

<footer>© 2025 Warung Pak Jhon Regency</footer>

<script>
/* ===== data & config ===== */
const IMAGES_PREFIX = 'images/'; // folder di repo (sesuaikan jika beda)
const FREE_SHIPPING_MIN = 50000; // subsidi ongkir di dalam regency
const BASE_ONGKIR = 5000; // dasar ongkir
const PER_KM = 2000; // per km ongkir jika antar
const TABLE_COUNT = 12;

/* placeholder data-uri: simple gray svg (no external file needed) */
const PLACEHOLDER_DATAURI = 'data:image/svg+xml;utf8,' + encodeURIComponent(
  '<svg xmlns="http://www.w3.org/2000/svg" width="600" height="400"><rect width="100%" height="100%" fill="#f3f3f3"/><text x="50%" y="50%" dominant-baseline="middle" text-anchor="middle" fill="#bbb" font-size="24">No Image</text></svg>'
);

/* menu items: make sure these img names match files in your images folder (exactly) */
const MENU = [
  {id:'nk_telur', name:'Nasi Kuning - Telur', price:13000, img:'nk_telur.jpg', category:'Nasi Kuning'},
  {id:'nk_daging', name:'Nasi Kuning - Daging', price:16000, img:'nk_daging.jpg', category:'Nasi Kuning'},
  {id:'nk_ikan', name:'Nasi Kuning - Ikan', price:20000, img:'nk_ikan.jpg', category:'Nasi Kuning'},
  {id:'nk_ayam_bakar', name:'Nasi Kuning - Ayam Bakar', price:16000, img:'nasi kuning ayam bakar.jpg', category:'Nasi Kuning'},
  {id:'nk_ayamkrispi', name:'Nasi Kuning - Ayam Krispi', price:16000, img:'nk_ayam krispi.jpg', category:'Nasi Kuning'},
  {id:'paket_tumpeng', name:'Paket Tumpeng', price:300000, img:'paket_tumpeng.jpg', category:'paket'},
  {id:'paket_hampers', name:'Paket Hampers', price:250000, img:'paket_hampers.jpg', category:'paket'},
  {id:'paket_liwetan', name:'Paket Liwetan', price:150000, img:'paket_liwetan.jpg', category:'paket'},
  {id:'es_mangga', name:'Es Mangga', price:5000, img:'es_mangga.jpg', category:'es'},
  {id:'es_alpukat', name:'Es Alpukat', price:5000, img:'es_alpukat.jpg', category:'es'},
  {id:'es_sirsak', name:'Es Sirsak', price:5000, img:'es_sirsak.jpg', category:'es'},
  {id:'es_kuwud', name:'Es Kuwud', price:5000, img:'es_kuwud.jpg', category:'es'},
  {id:'es_teh', name:'Es Teh', price:3000, img:'es_teh.jpg', category:'Minuman'}
];


let state = {
  user: null,
  cart: [],
  tableStatus: Array(TABLE_COUNT).fill(false) // false=kosong true=terpakai
};

/* ===== utils ===== */
function rupiah(n){ return Number(n).toLocaleString('id-ID'); }
function el(id){ return document.getElementById(id); }
function saveState(){ localStorage.setItem('wpj_state', JSON.stringify(state)); }
function loadState(){ const s = localStorage.getItem('wpj_state'); if(s) state = JSON.parse(s); }

/* ===== init UI ===== */
function init(){
  loadState();
  // set logo src using IMAGES_PREFIX and encodeURIComponent to handle spaces
  const logoEl = el('logo');
  logoEl.onerror = ()=>{ logoEl.src = PLACEHOLDER_DATAURI; };
  logoEl.src = IMAGES_PREFIX + encodeURIComponent('logo.png');

  populateTables();
  renderCats();
  renderMenu();
  renderCart();
  updateTableInfo();
  // set greeting if logged in
  if(state.user) {
    el('greeting').innerText = 'Halo, ' + state.user.name;
    go('pageMenu');
  } else {
    go('pageLogin');
  }
  // populate table select
  const sel = el('tableNo'); sel.innerHTML = '<option value="">Pilih meja (opsional)</option>';
  for(let i=1;i<=TABLE_COUNT;i++) sel.appendChild(new Option('Meja '+i,i));
}
init();

/* ===== navigation ===== */
function go(pageId){
  document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));
  el(pageId).classList.add('active');
}
function openCheckout(){
  if(state.cart.length===0){ alert('Keranjang kosong'); return; }
  if(!state.user){ alert('Silakan login/daftar terlebih dahulu'); go('pageLogin'); return; }
  buildNota();
  go('pageNota');
}

/* ===== registration / login demo ===== */
function register(){
  const name = el('reg_name').value.trim();
  const phone = el('reg_phone').value.trim();
  const email = el('reg_email').value.trim();
  const pw = el('reg_pass').value.trim();
  if(!name||!phone||!email||!pw) return alert('Lengkapi data pendaftaran.');
  localStorage.setItem('wpj_user_'+email, JSON.stringify({name,phone,email,pw}));
  alert('Akun dibuat. Silakan login.');
}
function login(){
  const id = el('login_id').value.trim();
  const pw = el('login_pw').value.trim();
  for(let k in localStorage){
    if(k.startsWith('wpj_user_')){
      const u = JSON.parse(localStorage.getItem(k));
      if((u.email===id||u.phone===id) && u.pw===pw){
        state.user = {name:u.name,phone:u.phone,email:u.email};
        saveState();
        el('greeting').innerText = 'Halo, ' + state.user.name;
        go('pageMenu');
        return;
      }
    }
  }
  alert('Pengguna tidak ditemukan / password salah');
}
function demoLogin(){
  state.user = {name:'Demo User', phone:'0812345678', email:'demo@demo'};
  saveState(); el('greeting').innerText = 'Halo, ' + state.user.name; go('pageMenu');
}
el('logoutBtn').addEventListener('click', ()=>{ if(confirm('Keluar aplikasi?')){ state.user=null; saveState(); go('pageLogin'); } });

/* ===== menu / categories ===== */
function renderCats(){
  const cats = ['All', ...new Set(MENU.map(m=>m.category))];
  const wrap = el('cats'); wrap.innerHTML='';
  cats.forEach(c=>{
    const b=document.createElement('button'); b.className='chip'; b.innerText=c;
    b.onclick=()=>{
      document.querySelectorAll('.chip').forEach(x=>x.classList.remove('active'));
      b.classList.add('active');
      renderMenu();
    };
    if(c==='All') b.classList.add('active');
    wrap.appendChild(b);
  });
}
function getSelectedCategory(){
  const active = document.querySelector('.chip.active');
  return active? active.innerText : 'All';
}
function renderMenu(){
  const grid = el('menuGrid'); grid.innerHTML='';
  const q = el('search').value.trim().toLowerCase();
  const cat = getSelectedCategory();
  let items = MENU.filter(it => (cat==='All' || it.category===cat) && (q==='' || it.name.toLowerCase().includes(q)));
  // sort
  const sort = el('sort').value;
  if(sort==='price_asc') items.sort((a,b)=>a.price-b.price);
  if(sort==='price_desc') items.sort((a,b)=>b.price-a.price);

  items.forEach(it=>{
    const card = document.createElement('div'); card.className='card';
    const img = document.createElement('img');
    // use encodeURIComponent to safely include filenames with spaces
    img.onerror = ()=>{ img.src = PLACEHOLDER_DATAURI; };
    img.src = IMAGES_PREFIX + encodeURIComponent(it.img);
    img.alt = it.name;
    const info = document.createElement('div'); info.className='info';
    info.innerHTML = `<div style="font-weight:700">${it.name}</div><div class="price">Rp ${rupiah(it.price)}</div>`;
    const actions = document.createElement('div');
    actions.style.display='flex'; actions.style.flexDirection='column'; actions.style.gap='8px';
    const btnAdd = document.createElement('button'); btnAdd.className='btn btn-add'; btnAdd.innerText='Tambah'; btnAdd.onclick = ()=>{ addToCart(it.id); };
    const btnView = document.createElement('button'); btnView.className='btn btn-view'; btnView.innerText='+1 & Lihat'; btnView.onclick = ()=>{ alert(it.name + '\nHarga: Rp ' + rupiah(it.price)); };
    actions.appendChild(btnAdd); actions.appendChild(btnView);

    card.appendChild(img); card.appendChild(info); card.appendChild(actions);
    grid.appendChild(card);
  });

  if(items.length===0) grid.innerHTML = '<div style="padding:12px;color:var(--muted)">Tidak ada menu.</div>';
}

/* ===== cart logic ===== */
function addToCart(id){
  const f = state.cart.find(x=>x.id===id);
  if(f) f.q++;
  else state.cart.push({id,q:1});
  saveState(); renderCart();
}
function removeFromCart(id){
  state.cart = state.cart.filter(x=>x.id!==id);
  saveState(); renderCart();
}
function changeQty(id,delta){
  const f = state.cart.find(x=>x.id===id); if(!f) return;
  f.q = Math.max(1, f.q + delta);
  saveState(); renderCart();
}
function renderCart(){
  const list = el('cartList'); list.innerHTML='';
  if(state.cart.length===0){ el('cartCount').innerText='(0)'; list.innerHTML = '<div class="cart-empty">Belum ada item</div>'; updateTotals(); return; }
  el('cartCount').innerText = '('+ state.cart.length +')';
  state.cart.forEach(ci=>{
    const m = MENU.find(mm=>mm.id===ci.id);
    const div = document.createElement('div'); div.className='cart-item';
    div.innerHTML = `<div style="flex:1">${m.name} <div style="font-size:12px;color:var(--muted)">x${ci.q}</div></div><div style="text-align:right">Rp ${rupiah(m.price*ci.q)}<div style="margin-top:6px"><button class="btn btn-view" onclick="changeQty('${ci.id}',-1)">-</button> <button class="btn btn-view" onclick="changeQty('${ci.id}',1)">+</button> <button class="btn btn-view" onclick="removeFromCart('${ci.id}')">hapus</button></div></div>`;
    list.appendChild(div);
  });
  updateTotals();
}

/* ===== totals & ongkir ===== */
function updateOngkir(){
  renderCart();
}
function updateTotals(){
  const sub = state.cart.reduce((s,c)=> s + (MENU.find(m=>m.id===c.id).price * c.q), 0);
  let ong = 0;
  const delivery = el('deliveryType').value;
  const region = el('region').value;
  const dist = Number(el('distance').value) || 0;
  if(delivery==='delivery'){
    if(region==='regency' && sub >= FREE_SHIPPING_MIN) ong = 0;
    else ong = BASE_ONGKIR + Math.round(dist * PER_KM);
  }
  el('subtotal').innerText = rupiah(sub);
  el('ongkir').innerText = rupiah(ong);
  el('grand').innerText = rupiah(sub + ong);
}

/* ===== checkout & nota ===== */
function buildNota(){
  const sub = Number(el('subtotal').innerText.replace(/\D/g,'')) || 0;
  const ong = Number(el('ongkir').innerText.replace(/\D/g,'')) || 0;
  const total = sub + ong;
  const notadiv = el('notaContent'); let html = '';
  html += `<div style="padding:12px;border-radius:8px;background:#fff;border:1px solid #eee">`;
  html += `<center><img src="${IMAGES_PREFIX + encodeURIComponent('logo.png')}" width="70" onerror="this.src='${PLACEHOLDER_DATAURI}'"><h3>Warung Pak Jhon Regency</h3></center>`;
  html += `<div>No: ${Date.now().toString().slice(-6)}</div>`;
  html += `<div>Nama: ${state.user.name}</div>`;
  html += `<div>HP: ${state.user.phone}</div>`;
  html += `<div>Tgl: ${new Date().toLocaleString()}</div><hr>`;
  state.cart.forEach(c=>{
    const m = MENU.find(x=>x.id===c.id);
    html += `<div style="display:flex;justify-content:space-between"><div>${m.name} x${c.q}</div><div>Rp ${rupiah(m.price * c.q)}</div></div>`;
  });
  html += `<hr><div>Subtotal: Rp ${rupiah(sub)}</div><div>Ongkir: Rp ${rupiah(ong)}</div><h3>Total: Rp ${rupiah(total)}</h3>`;
  html += `<div>Metode: ${el('payMethod').value}</div>`;
  html += `<p style="text-align:center;margin-top:8px">Terima kasih, pesanan Anda sedang diproses.</p></div>`;
  notadiv.innerHTML = html;
  state.cart = []; saveState(); renderCart();
}
function printNota(){ window.print(); }

/* ===== table panel ===== */
function populateTables(){
  const panel = el('tablePanel'); panel.innerHTML='';
  for(let i=1;i<=TABLE_COUNT;i++){
    const b = document.createElement('button'); b.className='chip'; b.innerText='Meja '+i;
    b.onclick = ()=>{ state.tableStatus[i-1] = !state.tableStatus[i-1]; b.classList.toggle('active'); updateTableInfo(); saveState(); };
    if(state.tableStatus[i-1]) b.classList.add('active');
    panel.appendChild(b);
  }
  const s = el('tableNo'); s.innerHTML = '<option value="">Pilih meja (opsional)</option>';
  for(let i=1;i<=TABLE_COUNT;i++) s.appendChild(new Option('Meja '+i,i));
}
function updateTableInfo(){
  const tot = TABLE_COUNT;
  const used = state.tableStatus.filter(x=>x).length;
  const empty = tot - used;
  el('mejaInfo').innerText = `Meja: ${empty} kosong • ${used} terpakai`;
}

/* ===== small helpers ===== */
function clearCart(){ if(confirm('Kosongkan keranjang?')){ state.cart=[]; saveState(); renderCart(); } }

</script>
</body>
</html>
